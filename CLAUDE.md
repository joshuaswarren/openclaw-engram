# openclaw-engram

## PUBLIC REPOSITORY â€” Privacy Policy

**This repository is PUBLIC on GitHub.** Every commit is visible to the world.

### Rules for ALL agents committing to this repo:

1. **NEVER commit personal data** â€” no names, emails, addresses, phone numbers, account IDs, or user identifiers
2. **NEVER commit API keys, tokens, or secrets** â€” even in comments or examples
3. **NEVER commit memory content** â€” the `facts/`, `entities/`, `corrections/`, `questions/`, `state/` directories contain user memories and must NEVER be committed
4. **NEVER commit IDENTITY.md or profile.md** â€” these contain personal behavioral profiles
5. **NEVER commit `.env` files** or any file containing credentials
6. **NEVER reference specific users, their preferences, or their data** in code comments or commit messages
7. **Config examples must use placeholders** â€” `${OPENAI_API_KEY}`, not actual keys
8. **Test data must be synthetic** â€” never use real conversation data in tests

### What IS safe to commit:
- Source code (`src/`, `scripts/`)
- Package manifests (`package.json`, `tsconfig.json`, `tsup.config.ts`)
- Plugin manifest (`openclaw.plugin.json`)
- Documentation (`README.md`)
- Build configuration
- `.gitignore`
- This `CLAUDE.md` file

### Before every commit, verify:
- `git diff --cached` contains NO personal information
- No hardcoded API keys, URLs with tokens, or credentials
- No references to specific users or their data

## Architecture Notes

### File Structure
```
src/
â”œâ”€â”€ index.ts              # Plugin entry point, hook registration
â”œâ”€â”€ config.ts             # Config parsing with defaults
â”œâ”€â”€ types.ts              # TypeScript interfaces
â”œâ”€â”€ logger.ts             # Logging wrapper
â”œâ”€â”€ orchestrator.ts       # Core memory coordination
â”œâ”€â”€ storage.ts            # File I/O for memories
â”œâ”€â”€ buffer.ts             # Smart turn buffering
â”œâ”€â”€ extraction.ts         # GPT-5.2 extraction engine
â”œâ”€â”€ qmd.ts                # QMD search client
â”œâ”€â”€ importance.ts         # Importance scoring
â”œâ”€â”€ chunking.ts           # Large content chunking
â”œâ”€â”€ threading.ts          # Conversation threading
â”œâ”€â”€ topics.ts             # Topic extraction
â”œâ”€â”€ tools.ts              # Agent tools
â””â”€â”€ cli.ts                # CLI commands
```

### Key Patterns

1. **Three-phase flow** â€” recall (before), buffer (after), extract (periodic)
2. **Smart buffer** â€” decides when to flush based on content signals
3. **GPT-5.2 for extraction** â€” uses OpenAI Responses API (NOT Chat Completions)
4. **QMD for search** â€” hybrid BM25 + vector + reranking
5. **Markdown + YAML frontmatter** â€” human-readable storage format
6. **Consolidation** â€” periodic merging, cleaning, and summarization

### Integration Points

- `api.on("gateway_start")` â€” initialize orchestrator
- `api.on("before_agent_start")` â€” inject memory context
- `api.on("agent_end")` â€” buffer turn for extraction
- `api.registerTool()` â€” memory search, stats, etc.
- `api.registerCommand()` â€” CLI interface
- `api.registerService()` â€” service lifecycle

### Testing Locally

```bash
# Build
npm run build

# Full restart (gateway_start hook needs this)
launchctl kickstart -k gui/501/ai.openclaw.gateway

# Or for hot reload (but gateway_start won't fire)
kill -USR1 $(pgrep openclaw-gateway)

# Trigger a conversation to test

# View logs
grep "\[engram\]" ~/.openclaw/logs/gateway.log
```

### Common Gotchas

1. **OpenAI must use Responses API** â€” never Chat Completions (per CLAUDE.md guidelines)
2. **Zod optional fields** â€” must use `.optional().nullable()`, not just `.optional()`
3. **Gateway launchd env isolated** â€” API keys must be in plist EnvironmentVariables
4. **Config schema strict** â€” new properties MUST be added to `openclaw.plugin.json` configSchema
5. **SIGUSR1 doesn't fire gateway_start** â€” use `launchctl kickstart -k` for full restart
6. **profile.md injected everywhere** â€” keep under 600 lines or consolidation triggers

<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 5, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #1406 | 4:59 PM | ðŸ”µ | Engram Plugin Not Under Version Control | ~235 |
| #1404 | " | âœ… | Privacy Policy Added to Engram Plugin Documentation | ~503 |
| #1403 | " | âœ… | Engram plugin .gitignore created protecting user memory data from version control | ~435 |
| #1376 | 4:53 PM | ðŸ”µ | Engram Plugin Contains No Hardcoded Network Addresses | ~320 |
| #1375 | " | ðŸ”µ | Engram plugin architecture combines GPT-5.2 extraction with QMD storage | ~396 |
| #1371 | 4:52 PM | ðŸ”µ | CLAUDE.md file exists but is empty in openclaw-engram extension | ~299 |
| #1267 | 2:18 PM | âœ… | Engram Plugin Rebuilt After Configuration Changes | ~259 |
| #1197 | 10:09 AM | ðŸŸ£ | Plugin Configuration Schema and UI Hints Defined | ~624 |
| #1114 | 8:26 AM | ðŸŸ£ | Engram memory plugin documented with local-first architecture and GPT-5.2 extraction | ~305 |
| #1104 | 8:24 AM | ðŸ”µ | Engram plugin provides local-first memory using GPT-5.2 extraction and QMD storage | ~453 |
| #1052 | 8:11 AM | ðŸ”µ | Engram memory plugin discovered with QMD integration and intelligent extraction | ~502 |
| #1013 | 6:58 AM | âœ… | Build banner comment updated completing plugin rename to openclaw-engram | ~342 |
| #1009 | 6:57 AM | âœ… | QMD collection UI placeholder updated to openclaw-engram | ~252 |
| #1008 | " | âœ… | QMD collection default updated to openclaw-engram | ~245 |
| #1007 | " | âœ… | Plugin manifest id updated to openclaw-engram | ~270 |
| #1006 | 6:56 AM | âœ… | Package name updated to openclaw-engram | ~255 |
| #1005 | " | ðŸ”µ | Package.json still references old openclaw-memory name after directory rename | ~250 |
</claude-mem-context>